  - name: deploy F5 WAAP thru ARM template
    azure_rm_deployment:
       state: present
       resource_group_name: '{{ az_rg }}'
       location: '{{ az_loc }}'
       template_link: https://raw.githubusercontent.com/F5Networks/f5-azure-arm-templates/master/supported/standalone/1nic/existing_stack/PAYG/azuredeploy.json
       parameters:
          adminUsername:
              value: "{{ admin_username }}"
          adminPassword:
              value: "{{ admin_password }}"
          dnsLabel:
              value: '{{ f5_instance_name }}'
          instanceName:
              value: '{{ f5_instance_name }}'
          instanceType:
              value: "Standard_DS2_v2"
          imageName:
              value: "Best"
          bigIpVersion:
              value: "{{ f5_sw_version }}"
          licensedBandwidth:
              value: "25m"
          vnetName:
              value: "hackazon_vn"
          vnetResourceGroupName:
              value: "{{ az_rg }}"
          mgmtSubnetName:
              value: "hackazon_subnet"
          mgmtIpAddress:
              value: "{{ f5_self_addr }}"
          avSetChoice:
              value: "CREATE_NEW"
          ntpServer:
              value: "0.pool.ntp.org"
          timeZone:
              value: "{{ timezone }}"
          restrictedSrcAddress:
              value: "*"
          tagValues:
              value:
                 Name: '{{ f5_instance_name }}'
                 Type: 'f5'
                 application: 'APP'
                 cost: 'COST'
                 environment: 'ENV'
                 group: 'GROUP'
                 owner: 'OWNER'
          allowUsageAnalytics:
              value: "Yes"
    register: f5waap_res_output
  - debug: var=f5waap_res_output
  - set_fact:
      f5_host: "{{ f5waap_res_output.deployment.instances[0].ips[0].public_ip }}"
